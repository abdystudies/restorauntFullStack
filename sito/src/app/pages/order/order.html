<div class="order-container">
  <header class="order-header">
    <h1>üì± Ordina i tuoi piatti preferiti</h1>
    <div class="cart-badge" *ngIf="getItemCount() > 0">
      {{ getItemCount() }} articoli nel carrello
    </div>
  </header>

  <div class="order-content">
    <!-- Sezione Prodotti -->
    <section class="products-section">
      <!-- Filtri categoria -->
      <div class="category-filter">
        <h2>Categorie</h2>
        <div class="category-buttons">
          <button
            *ngFor="let category of categories"
            [class.active]="selectedCategory === category"
            (click)="selectedCategory = category"
            class="category-btn"
          >
            <span *ngIf="category === 'pizzas'">üçï</span>
            <span *ngIf="category === 'salads'">ü•ó</span>
            <span *ngIf="category === 'drinks'">ü•§</span>
            {{ category | titlecase }}
          </button>
        </div>
      </div>

      <!-- Lista prodotti -->
      <div class="products-grid">
        <div class="product-card" *ngFor="let product of getProductsByCategory()">
          <div class="product-image">
            <img [src]="product.image" [alt]="product.name" />
          </div>
          <div class="product-info">
            <h3>{{ product.name }}</h3>
            <p class="product-description">{{ product.description }}</p>
            <div class="product-footer">
              <span class="product-price">‚Ç¨{{ product.price.toFixed(2) }}</span>
              <button class="add-btn" (click)="addToCart(product)">
                Aggiungi al carrello
              </button>
            </div>
          </div>
        </div>
      </div>

      <div class="empty-products" *ngIf="getProductsByCategory().length === 0">
        <p>Nessun prodotto disponibile in questa categoria</p>
      </div>
    </section>

    <!-- Sezione Carrello -->
    <aside class="cart-section">
      <div class="cart-header">
        <h2>üõí Riepilogo Ordine</h2>
      </div>

      <div class="cart-items" *ngIf="cart.items.length > 0; else emptyCart">
        <div class="cart-item" *ngFor="let item of cart.items">
          <div class="item-details">
            <h4>{{ item.product.name }}</h4>
            <p class="item-price">‚Ç¨{{ item.product.price.toFixed(2) }}</p>
          </div>
          <div class="item-quantity">
            <button
              (click)="updateQuantity(item.product.id, item.quantity - 1)"
              class="qty-btn"
            >
              ‚àí
            </button>
            <input
              type="number"
              [(ngModel)]="item.quantity"
              (change)="updateQuantity(item.product.id, item.quantity)"
              min="1"
              class="qty-input"
            />
            <button
              (click)="updateQuantity(item.product.id, item.quantity + 1)"
              class="qty-btn"
            >
              +
            </button>
          </div>
          <div class="item-subtotal">
            ‚Ç¨ {{ (item.product.price * item.quantity).toFixed(2) }}
          </div>
          <button
            (click)="removeFromCart(item.product.id)"
            class="remove-btn"
            title="Rimuovi dal carrello"
          >
            ‚úï
          </button>
        </div>

        <div class="cart-summary">
          <div class="summary-row">
            <span>Subtotale</span>
            <span>‚Ç¨{{ cart.totalPrice.toFixed(2) }}</span>
          </div>
          <div class="summary-row">
            <span>Costi di consegna</span>
            <span class="free" *ngIf="cart.totalPrice > 15">Gratis</span>
            <span *ngIf="cart.totalPrice <= 15">‚Ç¨2.99</span>
          </div>
          <div class="summary-row total">
            <span>Totale</span>
            <span>
              ‚Ç¨{{
                (cart.totalPrice + (cart.totalPrice > 15 ? 0 : 2.99)).toFixed(2)
              }}
            </span>
          </div>
        </div>

        <button
          (click)="proceedToCheckout()"
          class="checkout-btn"
          [disabled]="cart.items.length === 0"
        >
          Procedi al Checkout
        </button>
      </div>

      <ng-template #emptyCart>
        <div class="empty-cart">
          <p>Il tuo carrello √® vuoto</p>
          <small>Aggiungi alcuni piatti per iniziare</small>
        </div>
      </ng-template>
    </aside>
  </div>
</div>